version: "3.3"

services:
    app:
        image: the_platform:latest
        container_name: the_platform
        build:
            context: .
            dockerfile: Dockerfile.prod
        ports:
            - 4000:4000
        env_file:
            - .env
        environment:
            - MYSQL_PASSWORD=pass
            - MYSQL_USER=admin
            - MYSQL_HOST=mariadb
            - MYSQL_PORT=3306
            - MYSQL_DATABASE=blog
            - SECRET_KEY_BASE=d140269c106b6d064cdd670a5aace0bbbb1400de545377a47836dbdab8104f2fdf0ab87e6b7982819d1bcc2ccf6a5f093985a0895970f01f30b0b15378a090e9
        depends_on:
            - mariadb

    mariadb:
        image: mariadb:latest
        # image: jsurf/rpi-mariadb
        container_name: mariadb
        volumes:
            - ./volume/mysql:/var/lib/mysql
        restart: always
        ports:
            - 3307:3306
        environment:
            - MYSQL_ROOT_PASSWORD=root
            - MYSQL_PASSWORD=pass
            - MYSQL_USER=admin
            - MYSQL_DATABASE=blog